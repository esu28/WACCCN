\documentclass[acmsmall]{acmart}

\AtBeginDocument{%
  \providecommand\BibTeX{{Bib\TeX}}
}

% -------------------------
% PACKAGES
% -------------------------
\usepackage{amsmath,amssymb}
\usepackage{graphicx}
\usepackage{subcaption}
\usepackage{float}
\usepackage{adjustbox}
\usepackage{booktabs}
\usepackage{placeins}

% -------------------------
% COPYRIGHT / CONFERENCE INFO
% -------------------------
\setcopyright{acmcopyright}
\copyrightyear{2025}
\acmYear{2025}
\acmDOI{XXXXXXX.XXXXXXX}

\acmConference[WACCCN '25]{Wavelet-Based CCC Workshop}{2025}{USA}
\acmISBN{978-1-4503-XXXX-X/25/00}

\begin{document}

% -------------------------
% TITLE + AUTHORS
% -------------------------
\title[WACCCN]{Wavelet--Based Multiscale Anisotropy--Aware Cell--Cell Communication Inference and Niche Segmentation}

\author{Jiayu Ellie Su}
\email{jiayuelliesu@gmail.com}
\affiliation{%
  \institution{Phillips Academy Andover}
  \city{Andover}
  \state{MA}
  \country{USA}
}

\author{Scarlett Chen}
\email{} % TODO: add email
\affiliation{%
  \institution{} % TODO: add institution
  \city{}
  \country{}
}

\author{Shravya Mankala}
\email{} % TODO: add email
\affiliation{%
  \institution{} % TODO: add institution
  \city{}
  \country{}
}

\author{Winston Zhou}
\email{} % TODO: add email
\affiliation{%
  \institution{} % TODO: add institution
  \city{}
  \country{}
}

\author{Xiaodi Wang}
\email{} % TODO: add email
\affiliation{%
  \institution{} % TODO: add institution
  \city{}
  \country{}
}

\author{Yongzhong Zhao}
\email{} % TODO: add email
\affiliation{%
  \institution{} % TODO: add institution
  \city{}
  \country{}
}

\renewcommand{\shortauthors}{Su et al.}

\maketitle

\appendix
\section{Supplementary Methods}
\label{sec:supp-methods}

\subsection{Mask-aware Neighborhood Averages}
\label{supp:mask-average}

For fields on the histology grid, we compute masked, weighted means. Let $M$
be the binary tissue mask and $\Omega_q=\{p:\|p-q\|_2\le r\}$. Gaussian weights
\[
w_{q,p}=\exp\!\left(-\frac{\|p-q\|_2^2}{2\sigma_w^2}\right)
\]
are applied only to tissue pixels $M_p{=}1$. The masked mean is
\[
\langle X\rangle_q =
\frac{\sum_{p\in\Omega_q} w_{q,p}X_pM_p}{\sum_{p\in\Omega_q} w_{q,p}M_p+\varepsilon}.
\]
If the denominator is below $\varepsilon$, we return NaN.

\subsection{Anisotropy Variants}
\label{supp:aniso-variants}

We implement anisotropy using three transform families: 2-band DWT, 4-band
DWT, and DTCWT. Each provides a set of oriented subbands with known angles
$(\theta_b)$ and reliability weights $(\kappa_b)$ that guide corridor pooling.

\paragraph{2-band DWT.}
LH, HL, and HH maps (levels 1--2) are normalized and averaged across channels.
A simple reliability score
\[
r_{\mathrm{axis}}=\frac{|S_x-S_y|}{S_x+S_y+\varepsilon}
\]
with $S_x=E_v+\eta E_d$ and $S_y=E_h+\eta E_d$ maps to axis ratio $a\in[1,a_{\max}]$.

\paragraph{4-band DWT.}
Fifteen oriented subbands give richer orientation information. Corridor-pooled
powers $\bar P_b$ weighted by $\kappa_b$ define a doubled-angle resultant
\[
m=\sum_{b:\kappa_b\ge\tau_\kappa} \kappa_b\bar P_b\,e^{i2\theta_b},
\]
yielding $\theta^\star=\frac12\arg(m)$ and normalized anisotropy $r$.

\paragraph{Dual-tree Complex Wavelets (DTCWT).}
Six oriented complex subbands at angles
$\{15^\circ,45^\circ,75^\circ,105^\circ,135^\circ,165^\circ\}$ provide
orientation-sensitive features. Magnitudes and phase coherence produce a
weighted resultant
\[
m=\sum_{\ell,b}\omega^{(\ell)}_b\,\bar P^{(\ell)}_b\,e^{i2\theta_b}.
\]

\paragraph{Kernel Mapping.}
All variants map $r$ to an axis ratio
\[
a = 1+(a_{\max}-1)r^\gamma,
\]
then construct elliptical Gaussian kernels with variances
$(\sigma_\parallel^2,\sigma_\perp^2)=(1,1/a)$ and a short-axis floor. Exact
filter taps, orientation tables, and DWT/DTCWT metadata are omitted here for
brevity; researchers may contact the authors for the full supplementary
package.

\subsection{CCC Hyperparameters}
\label{sec:tuning_ccc}

CCC calculations use winsorized ($p99$) and min--max scaled expression.
Secreted ligand dispersion uses anisotropic $+$ radial kernels; membrane-bound
interactions use a near-contact radius. The Hill response uses
$K_{\mathrm{half}}{=}0.01$.

Null distributions use $n_{\mathrm{null}}{=}1000$ matched-marginal surrogates.
The morphology gate $G_{i\to j}$ depends only on histology and is reused
across all nulls. The similarity scale $\sigma_{\mathrm{sim}}$ is tuned to keep
the top 10--20\% of edges moderately boosted, and $\beta_+$ is calibrated so
that fewer than 5\% of edges receive more than a three-fold gain.

\subsection{Autoencoder Objective}
\label{supp:autoencoder-details}

Let $Z\in\mathbb{R}^{N\times d}$ be latent embeddings and $X^{(v)}$ the $v$-th
input view with $F_v$ features and reconstructions $\hat X^{(v)}$.

\paragraph{Reconstruction.}
\[
\mathcal{L}_{\text{rec}}
=\sum_{v}\frac{1}{F_v}\cdot\frac{1}{N}\sum_i\left\lVert X^{(v)}_{i\cdot}-\hat X^{(v)}_{i\cdot}\right\rVert_2^2.
\]

\paragraph{CCC-Laplacian Smoothness.}
Let $W$ be a row-normalized average CCC affinity:
\[
\mathcal{L}_{\text{lap}}
=\frac{1}{N}\sum_i\!\left\lVert Z_{i\cdot}-\sum_j W_{ij} Z_{j\cdot}\right\rVert_2^2.
\]

\paragraph{Contrastive (InfoNCE).}
We use cosine similarity $\mathrm{sim}_{ij} = \tilde Z_{i\cdot}^\top \tilde Z_{j\cdot}/\tau$
with $\tilde Z_{i\cdot}=Z_{i\cdot}/\|Z_{i\cdot}\|_2$ and temperature $\tau$:
\[
\mathcal{L}_{\text{InfoNCE}}
=\frac{1}{N}\sum_i\frac{1}{|\mathcal{P}(i)|}\sum_{j\in\mathcal{P}(i)}
\left[-\,\mathrm{sim}_{ij}+\log\!\sum_{\ell\neq i}\exp(\mathrm{sim}_{i\ell})\right],
\]
where $\mathcal{P}(i)$ are positives (top-$k$ neighbors in $W$).

\paragraph{Deep Embedded Clustering.}
We define Student-$t$ assignments
\[
q_{ik}\propto (1+\|Z_{i\cdot}-c_k\|_2^2)^{-1},
\]
and a sharpened target
\[
p_{ik}=\frac{q_{ik}^2}{\sum_i q_{ik}},
\]
then minimize
\[
\mathcal{L}_{\text{DEC}}
=\frac{1}{N}\sum_{i,k} p_{ik}\log\!\frac{p_{ik}}{q_{ik}}.
\]

\paragraph{Total Loss.}
\[
\mathcal{L}
=\lambda_{\text{rec}}\mathcal{L}_{\text{rec}}
+\lambda_{\text{lap}}\mathcal{L}_{\text{lap}}
+\lambda_{\text{nce}}\mathcal{L}_{\text{InfoNCE}}
+\lambda_{\text{dec}}\mathcal{L}_{\text{DEC}},
\]
with default
$(\lambda_{\text{rec}},\lambda_{\text{lap}},\lambda_{\text{nce}},\lambda_{\text{dec}})
=(1.0,\,0.08,\,0.25,\,0.15)$, $k{=}18$, $d{=}32$, $K{=}30$, and $\tau{=}0.12$.

\subsection{Anisotropy Metrics}
\label{supp:metrics-aniso}

Let $S$ be the number of spots and $\mathbf{c}_i\in\mathbb{R}^2$ the centroid
of spot $i$. All orientations are treated as axial
($\theta\equiv\theta{+}\pi$). The spot scale $h$ is the median 1-NN distance.

\paragraph{Outgoing Angular Concentration.}
For spot $i$, let $w_{ij}\!\ge 0$ be directed edge weights and $\phi_{ij}$ the
signed bearing of edge $i\!\to\!j$ relative to the local tissue axis
$\theta_i$. The weighted angular concentration is
\[
R_w(i)=
\frac{\left|\sum_j w_{ij}\,e^{2i\phi_{ij}}\right|}{\sum_j w_{ij}}\in[0,1].
\]

\paragraph{Net CCC Direction and Strength.}
The complex resultant
\[
\mathbf{v}_i=\sum_j w_{ij}e^{i\phi_{ij}}
\]
defines the net communication direction $\alpha_i=\arg(\mathbf{v}_i)$ and
coherence
\[
R_{\mathrm{CCC}}(i)=\frac{|\mathbf{v}_i|}{\sum_j w_{ij}}.
\]

\paragraph{Global Axial Alignment.}
With $\Delta\theta_i=\alpha_i-\theta_i$,
\[
A=\frac{1}{S}\sum_{i=1}^S
\cos\!\bigl(2\,\Delta\theta_i\bigr).
\]

\paragraph{Neighborhood Coherence.}
For neighborhoods $\mathcal{N}_r(i)=\{k:\|\mathbf{c}_k-\mathbf{c}_i\|\le r\}$,
\[
A_{\text{neigh}}(i)=\frac{1}{|\mathcal{N}_r(i)|}\sum_{k\in\mathcal{N}_r(i)}
\cos\!\bigl(2(\alpha_k-\theta_k)\bigr),
\]
\[
R_{\text{neigh}}(i)=\frac{1}{|\mathcal{N}_r(i)|}\,\Bigl|\sum_{k\in\mathcal{N}_r(i)} e^{2i\alpha_k}\Bigr|.
\]

\paragraph{Orientation Variogram and Coherence Length.}
The orientation variogram is
\[
V(\delta)
=\mathbb{E}\!\left[\cos\!\bigl(2(\theta(x{+}\delta)-\theta(x))\bigr)\right],
\]
with coherence length
\[
L_c=\inf\{\delta>0: V(\delta)\le 0.2\}.
\]

\subsection{Niche Agreement Metrics}
\label{supp:metrics-niche}

We report ARI, NMI, V-measure, Purity, one-to-one accuracy (Hungarian matched),
macro/weighted F1, and silhouette scores. ARI is
\[
\mathrm{ARI}
=\frac{\sum_{ij}\binom{n_{ij}}{2}
-\frac{\sum_i \binom{a_i}{2}\sum_j \binom{b_j}{2}}{\binom{n}{2}}}
{\frac12\!\left[\sum_i\binom{a_i}{2}+\sum_j\binom{b_j}{2}\right]
-\frac{\sum_i \binom{a_i}{2}\sum_j \binom{b_j}{2}}{\binom{n}{2}}},
\]
with $n_{ij}$ contingency counts, $a_i=\sum_j n_{ij}$, $b_j=\sum_i n_{ij}$,
$n=\sum_{ij}n_{ij}$.

\section*{Supplementary Tables}
Full wavelet filter banks, DWT/DTCWT tabulations, orientation metadata, and
additional implementation details are omitted for brevity.  
\textbf{Contact the authors to obtain the full supplementary table package.}


\end{document}
